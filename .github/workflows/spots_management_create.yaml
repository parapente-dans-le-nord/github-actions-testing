name: spots_creator_with_issue
on:
  issues:
    types: [opened, edited]
jobs:
  addSpot:
    # if: creator = alain ou moi
    if: contains( github.event.issue.labels.*.name, 'addSpot')

    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: parse issue and add spot to spots.json
        id: run-action-docker
        uses: parapente-dans-le-nord/dockerized-github-action@main
        with:
          issueBody: ${{ github.event.issue.body }}

      - uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: add spot from actions
          branch: feature-12
          create_branch: true

      - name: create pull request
        run: gh pr create -B main -H feature-12 --title 'Merge feature-12 into main' --body 'Created by Github action'
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      
      - name: merge pull request
        run: gh pr merge feature-12 --delete-branch
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      - run: gh issue comment $ISSUE --body "Le spot est ajout√© !!!"
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          ISSUE: ${{ github.event.issue.html_url }}